{"ast":null,"code":"import _objectSpread from\"/Users/todoporunalma/Desktop/Corporacion/coptua_react/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// Servicio API para comunicaci√≥n con Spring Boot Backend\nimport axios from'axios';// Configuraci√≥n base de la API\n// Usar la URL del host actual para la API\nconst API_BASE_URL=process.env.REACT_APP_API_BASE_URL||\"\".concat(window.location.protocol,\"//\").concat(window.location.hostname,\":8080/api\");console.log('üîß API_BASE_URL configurada como:',API_BASE_URL);// Crear instancia de axios con configuraci√≥n base\nconst apiClient=axios.create({baseURL:API_BASE_URL,timeout:30000,// Aumentar timeout a 30 segundos\n// withCredentials: false, // Deshabilitado temporalmente para evitar CORS issues\nheaders:{'Content-Type':'application/json'}});// Interceptor para agregar token de autenticaci√≥n\napiClient.interceptors.request.use(config=>{console.log('üöÄ Enviando request a:',config.baseURL+config.url);const token=localStorage.getItem('authToken');if(token){config.headers.Authorization=\"Bearer \".concat(token);}return config;},error=>{console.error('‚ùå Error en request interceptor:',error);return Promise.reject(error);});// Interceptor para manejar respuestas y errores\napiClient.interceptors.response.use(response=>{console.log('‚úÖ Response exitoso:',response.status,response.config.url);return response;},error=>{var _error$response;console.error('‚ùå Error en response:',error);// Manejar errores de autenticaci√≥n\nif(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status)===401){localStorage.removeItem('authToken');localStorage.removeItem('currentUser');window.location.href='/login';}// Manejar errores de red\nif(!error.response){console.error('üî• Error de red completo:',error);console.error('üî• Error message:',error.message);console.error('üî• Error code:',error.code);console.error('üî• Error config:',error.config);return Promise.reject({message:\"Error de conexi\\xF3n con el servidor: \".concat(error.message),status:0,originalError:error});}console.error('üî• Error con response:',error.response.status,error.response.data);return Promise.reject(error.response.data||error);});// Definici√≥n de roles del sistema\nexport const ROLES={CONSULTA:'CONSULTA',ADMINISTRADOR:'ADMINISTRADOR'};class ApiService{// ==================== AUTENTICACI√ìN ====================\n// Iniciar sesi√≥n\nasync login(email,password){try{const response=await apiClient.post('/auth/login',{email,password});console.log('üîç Response completa:',response.data);// La API devuelve {data: {token, user}, error: null}\nconst{data:responseData,error:responseError}=response.data;if(responseError){throw new Error(responseError.message||'Error en el servidor');}const{token,user}=responseData;// Guardar token y usuario en localStorage\nlocalStorage.setItem('authToken',token);localStorage.setItem('currentUser',JSON.stringify(user));console.log('‚úÖ Login exitoso, usuario guardado:',user);return{data:{user,token},error:null};}catch(error){console.error('Error en login:',error);return{data:null,error:{message:error.message||'Error al iniciar sesi√≥n'}};}}// Cerrar sesi√≥n\nasync logout(){try{await apiClient.post('/auth/logout');// Limpiar localStorage\nlocalStorage.removeItem('authToken');localStorage.removeItem('currentUser');return{success:true,error:null};}catch(error){console.error('Error en logout:',error);// Limpiar localStorage aunque falle la petici√≥n\nlocalStorage.removeItem('authToken');localStorage.removeItem('currentUser');return{success:true,error:null};}}// Restablecer contrase√±a\nasync resetPassword(email){try{const response=await apiClient.post('/auth/reset-password',{email});return{data:response.data,error:null};}catch(error){console.error('Error en reset password:',error);return{data:null,error:{message:error.message||'Error al restablecer contrase√±a'}};}}// Obtener usuario actual\nasync getCurrentUser(){try{const storedUser=localStorage.getItem('currentUser');const storedToken=localStorage.getItem('authToken');console.log('üîç Verificando localStorage:',{hasUser:!!storedUser,hasToken:!!storedToken});if(storedUser&&storedToken){try{const user=JSON.parse(storedUser);console.log('üë§ Usuario recuperado del localStorage:',user);// Verificar que el usuario tenga los campos necesarios\nif(user&&user.email&&user.id){return{data:user,error:null};}else{console.warn('‚ö†Ô∏è Usuario en localStorage est√° corrupto');localStorage.removeItem('currentUser');localStorage.removeItem('authToken');return{data:null,error:null};}}catch(parseError){console.error('‚ùå Error parseando usuario del localStorage:',parseError);localStorage.removeItem('currentUser');localStorage.removeItem('authToken');return{data:null,error:null};}}console.log('‚ùå No hay usuario o token en localStorage');return{data:null,error:null};}catch(error){console.error('‚ùå Error obteniendo usuario actual:',error);return{data:null,error};}}// Actualizar perfil de usuario\nasync updateProfile(profileData){try{const response=await apiClient.put('/auth/profile',profileData);// Actualizar usuario en localStorage\nconst currentUser=JSON.parse(localStorage.getItem('currentUser')||'{}');const updatedUser=_objectSpread(_objectSpread({},currentUser),response.data);localStorage.setItem('currentUser',JSON.stringify(updatedUser));return{data:response.data,error:null};}catch(error){console.error('Error actualizando perfil:',error);return{data:null,error:{message:error.message||'Error al actualizar perfil'}};}}// Verificar permisos del usuario\nasync hasPermission(requiredRole){try{const{data:user}=await this.getCurrentUser();if(!user)return false;const userRole=user.rol||ROLES.CONSULTA;// Jerarqu√≠a de roles: ADMINISTRADOR > CONSULTA\nconst roleHierarchy={[ROLES.ADMINISTRADOR]:2,[ROLES.CONSULTA]:1};const userLevel=roleHierarchy[userRole]||1;const requiredLevel=roleHierarchy[requiredRole]||1;return userLevel>=requiredLevel;}catch(error){console.error('Error verificando permisos:',error);return false;}}// ==================== DASHBOARD ====================\n// Obtener datos del dashboard\nasync getDashboardData(){try{const response=await apiClient.get('/dashboard/stats');return{data:response.data,error:null};}catch(error){console.error('Error obteniendo datos del dashboard:',error);return{data:{participantes:0,mensualidades:0},error};}}// ==================== PARTICIPANTES ====================\n// Obtener participantes\nasync getParticipantes(){try{const response=await apiClient.get('/participantes');return{data:response.data||[],error:null};}catch(error){console.error('Error obteniendo participantes:',error);return{data:[],error:{message:'Error al cargar participantes'}};}}// Crear nuevo participante\nasync createParticipante(participanteData){try{console.log('üîÑ Enviando datos de participante:',participanteData);// Validar datos requeridos\nif(!participanteData.nombre||!participanteData.telefono){return{data:null,error:{message:'Nombre y tel√©fono son campos obligatorios'}};}const response=await apiClient.post('/participantes',participanteData);console.log('‚úÖ Participante creado, respuesta:',response.data);return{data:response.data,error:null};}catch(error){var _error$response2,_error$response2$data;console.error('‚ùå Error creando participante:',error);return{data:null,error:{message:((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||error.message||'Error al crear participante'}};}}// Actualizar participante\nasync updateParticipante(id,participanteData){try{if(!id){return{data:null,error:{message:'ID de participante requerido'}};}const response=await apiClient.put(\"/participantes/\".concat(id),participanteData);return{data:response.data,error:null};}catch(error){console.error('Error actualizando participante:',error);return{data:null,error:{message:error.message||'Error al actualizar participante'}};}}// Eliminar participante\nasync deleteParticipante(id){try{await apiClient.delete(\"/participantes/\".concat(id));return{error:null};}catch(error){console.error('Error eliminando participante:',error);return{error:{message:error.message||'Error al eliminar participante'}};}}// ==================== MENSUALIDADES ====================\n// Obtener mensualidades\nasync getMensualidades(){try{const response=await apiClient.get('/mensualidades');return{data:response.data||[],error:null};}catch(error){console.error('Error obteniendo mensualidades:',error);return{data:[],error:{message:'Error al cargar mensualidades'}};}}// Crear nueva mensualidad\nasync createMensualidad(mensualidadData){try{if(!mensualidadData.participante_id||!mensualidadData.valor){return{data:null,error:{message:'Participante y valor son campos obligatorios'}};}const response=await apiClient.post('/mensualidades',mensualidadData);return{data:response.data,error:null};}catch(error){console.error('Error creando mensualidad:',error);return{data:null,error:{message:error.message||'Error al crear mensualidad'}};}}// Actualizar mensualidad\nasync updateMensualidad(id,mensualidadData){try{if(!id){return{data:null,error:{message:'ID de mensualidad requerido'}};}const response=await apiClient.put(\"/mensualidades/\".concat(id),mensualidadData);return{data:response.data,error:null};}catch(error){console.error('Error actualizando mensualidad:',error);return{data:null,error:{message:error.message||'Error al actualizar mensualidad'}};}}// ==================== SEDES ====================\n// Obtener sedes\nasync getSedes(){try{const response=await apiClient.get('/sedes');return{data:response.data||[],error:null};}catch(error){console.error('Error obteniendo sedes:',error);return{data:[],error:{message:'Error al cargar sedes'}};}}// ==================== UTILIDADES ====================\n// Verificar conexi√≥n con la API\nasync testConnection(){try{const response=await apiClient.get('/health');console.log('‚úÖ Conexi√≥n con API exitosa');return{success:true,data:response.data};}catch(error){console.error('‚ùå Error de conexi√≥n con API:',error.message);return{success:false,error:error.message||'Error de conexi√≥n'};}}// Obtener configuraci√≥n de la API\ngetApiConfig(){return{baseURL:API_BASE_URL,hasToken:!!localStorage.getItem('authToken'),environment:process.env.NODE_ENV,isConfigured:!!API_BASE_URL};}}// Exportar instancia √∫nica del servicio\nexport const api=new ApiService();export default api;// Exportar cliente axios para uso directo si es necesario\nexport{apiClient};","map":null,"metadata":{},"sourceType":"module"}